README.md (‡∏Å‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡∏ö)
Markdown

# üèõÔ∏è DGA Citizen Auth Service (C++ Version)

‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô (Authentication Service) ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏° **"‡∏ó‡∏≤‡∏á‡∏£‡∏±‡∏ê" (DGA)** ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏†‡∏≤‡∏©‡∏≤ **C++17** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (High Performance) ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ô‡πâ‡∏≠‡∏¢ (Lightweight) ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ö‡∏ô Docker Container ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• **PostgreSQL**

![C++](https://img.shields.io/badge/Language-C++17-blue.svg)
![Docker](https://img.shields.io/badge/Container-Docker-2496ED.svg)
![PostgreSQL](https://img.shields.io/badge/Database-PostgreSQL-336791.svg)

---

## ‚ú® ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å (Features)

* **DGA Integration:** ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡∏Ç‡∏≠‡∏á‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• (‡∏™‡∏û‡∏£.) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏ú‡πà‡∏≤‡∏ô `mToken`
* **Auto Login/Register Flow:**
  * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
  * ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß ‚Üí **Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à**
  * ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚Üí **‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å DGA ‡∏°‡∏≤ Pre-fill ‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô**
* **High Performance:** ‡πÉ‡∏ä‡πâ Library `cpp-httplib` ‡πÅ‡∏•‡∏∞ `libcurl` ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß
* **Database:** ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (Citizen ID, ‡∏ä‡∏∑‡πà‡∏≠, ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£) ‡∏•‡∏á PostgreSQL
* **Dockerized:** ‡∏û‡∏£‡πâ‡∏≠‡∏° Deploy ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏î‡πâ‡∏ß‡∏¢ Docker Compose

---

## üìÇ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå (Project Structure)

```text
my-dga-project/
‚îú‚îÄ‚îÄ public/                 # ‡πÑ‡∏ü‡∏•‡πå Frontend (HTML/JS)
‚îÇ   ‚îú‚îÄ‚îÄ index.html          # ‡∏´‡∏ô‡πâ‡∏≤ Login (‡∏£‡∏±‡∏ö mToken ‡πÅ‡∏•‡∏∞ Auto-check)
‚îÇ   ‚îî‚îÄ‚îÄ register.html       # ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô (‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ Pre-fill ‡∏à‡∏≤‡∏Å Login)
‚îú‚îÄ‚îÄ .env                    # (‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏á) ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤ Config ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ
‚îú‚îÄ‚îÄ docker-compose.yml      # ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Docker Services (App + DB)
‚îú‚îÄ‚îÄ Dockerfile              # ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Image ‡∏Ç‡∏≠‡∏á C++ Server
‚îú‚îÄ‚îÄ init.sql                # ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á Database ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
‚îî‚îÄ‚îÄ server.cpp              # ‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏•‡∏±‡∏Å (Core Logic) ‡∏†‡∏≤‡∏©‡∏≤ C++
üöÄ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Installation & Setup)
1. ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ (Prerequisites)
Docker ‡πÅ‡∏•‡∏∞ Docker Compose ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Server

2. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå
Clone ‡∏´‡∏£‡∏∑‡∏≠ Upload ‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏ö‡∏ô Server

Bash

# ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
cd ~/czp/test1
3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Environment Variables
‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå .env ‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ Config ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡πâ‡∏î

# Database Config
DB_HOST=db
DB_PORT=5432
DB_NAME=citizen_db
DB_USER=user
DB_PASS=password

# DGA / ‡∏ó‡∏≤‡∏á‡∏£‡∏±‡∏ê Config
AGENT_ID=YOUR_AGENT_ID
CONSUMER_KEY=YOUR_CONSUMER_KEY
CONSUMER_SECRET=YOUR_CONSUMER_SECRET

# Endpoints
DGA_AUTH_URL=[https://api.egov.go.th/ws/auth/validate](https://api.egov.go.th/ws/auth/validate)
DGA_DEPROC_URL=[https://api.egov.go.th/ws/dga/czp/uat/v1/core/shield/data/deproc](https://api.egov.go.th/ws/dga/czp/uat/v1/core/shield/data/deproc)
4. ‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå (Run)
‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á Docker Compose ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô Container:

Bash

# ‡∏£‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ --build)
docker compose up -d --build
üì° API Documentation
1. Login (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö mToken)
Endpoint: POST /api/auth/login

Description: ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ mToken ‡∏à‡∏≤‡∏Å Frontend ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏±‡∏ö DGA ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ User ‡πÉ‡∏ô DB ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

Request Body:

JSON

{
  "appId": "string",
  "mToken": "string"
}
Response (User ‡πÄ‡∏Å‡πà‡∏≤ - Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à):

JSON

{
  "status": "success",
  "type": "LOGIN",
  "user": { "id": "1", "firstname": "...", "lastname": "..." }
}
Response (User ‡πÉ‡∏´‡∏°‡πà - ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô):

JSON

{
  "status": "success",
  "type": "REGISTER_NEEDED",
  "prefill_data": { "citizen_id": "...", "firstname": "...", "lastname": "..." }
}
2. Register (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà)
Endpoint: POST /api/auth/register

Request Body:

JSON

{
  "citizen_id": "1234567890123",
  "firstname": "Somchai",
  "lastname": "Jaidee",
  "mobile": "0812345678"
}
üõ†Ô∏è ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢ (Troubleshooting)
1. Address already in use ‡∏´‡∏£‡∏∑‡∏≠ Port ‡∏ä‡∏ô
‡∏≠‡∏≤‡∏Å‡∏≤‡∏£: Docker ‡∏£‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô ‡∏ü‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤ Port 5432 ‡∏´‡∏£‡∏∑‡∏≠ 8080 ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á

‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡πÅ‡∏Å‡πâ‡πÑ‡∏ü‡∏•‡πå docker-compose.yml ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Port ‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤

YAML

ports:
  - "5071:8080"  # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô 5071 ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏≠‡∏∑‡πà‡∏ô
  - "5434:5432"  # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô 5434 ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏≠‡∏∑‡πà‡∏ô
2. ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô net::ERR_HTTP_RESPONSE_CODE_FAILURE
‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏: Server C++ ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å Path ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å (‡πÄ‡∏ä‡πà‡∏ô‡∏°‡∏µ / ‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÑ‡∏ü‡∏•‡πå .html)

‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:

‡πÅ‡∏Å‡πâ‡πÑ‡∏ü‡∏•‡πå server.cpp ‡πÄ‡∏û‡∏¥‡πà‡∏° Routing ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö (‡πÄ‡∏ä‡πà‡∏ô svr.Get("/test1/", ...) ‡πÅ‡∏•‡∏∞ svr.Get("/index.html", ...) )

‡∏™‡∏±‡πà‡∏á Rebuild ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏™‡∏°‡∏≠: docker compose up -d --build

3. ‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏: ‡∏•‡∏∑‡∏° Build ‡πÉ‡∏´‡∏°‡πà Docker ‡πÄ‡∏•‡∏¢‡πÄ‡∏≠‡∏≤ Image ‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡πà‡∏≤‡∏°‡∏≤‡∏£‡∏±‡∏ô

‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏∑‡∏°‡πÄ‡∏ï‡∏¥‡∏° --build ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î C++

Bash

docker compose up -d --build
üìù ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå (Useful Commands)
‡∏î‡∏π Logs ‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° (‡πÅ‡∏ö‡∏ö Realtime):

Bash

docker logs -f cpp_dga_service
‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏î‡∏π‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ú‡πà‡∏≤‡∏ô Terminal):

Bash

docker exec -it postgres_db psql -U user -d citizen_db
# ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á SQL: SELECT * FROM users;
# ‡∏≠‡∏≠‡∏Å: \q
‡∏•‡πâ‡∏≤‡∏á Database ‡∏ó‡∏¥‡πâ‡∏á (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà):

Bash

docker compose down -v
